<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width,initial-scale=1" name="viewport"/>
  <title>Scrummer ‚Äî Coach</title>

  <link rel="stylesheet" href="../css/style.css?v=221">
  <link rel="stylesheet" href="../css/coach.css?v=221">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,500,0,0" rel="stylesheet"/>

  <style>
    .tabBar{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 14px}
    .tabPanel.hidden{display:none}
    /* Align content to the left (avoids the "floating" gap next to the nav) */
    .coachWrap{max-width:1280px;margin:0;width:100%;}
    .fileInput{display:none;}
  </style>
</head>

<body data-page="coach">
  <div class="appShell">

    <aside class="sideNav eliteNav">
      <div class="sideBrand">
        <div class="brandMark"><span class="material-symbols-rounded">rocket_launch</span></div>
        <div>
          <div class="brandName">Scrummer</div>
          <div class="brandTag">Enterprise Edition</div>
        </div>
      </div>

      <nav class="nav">
        <a class="navlink" href="index.html">
          <span class="material-symbols-rounded navIco">calendar_month</span>
          <span>Plan</span>
        </a>
        <a class="navlink active" href="coach.html">
          <span class="material-symbols-rounded navIco">bar_chart</span>
          <span>Coach</span>
        </a>
        <a class="navlink" href="Gamerules.html">
          <span class="material-symbols-rounded navIco">gavel</span>
          <span>Game Rules</span>
        </a>
        <a class="navlink" href="accounts.html">
          <span class="material-symbols-rounded navIco">person</span>
          <span>Account</span>
        </a>
      </nav>

      <div class="xpWidget">
        <div class="xpTop">
          <div style="display:flex; gap:10px; align-items:center;">
            <span class="material-symbols-rounded" style="font-size:18px; opacity:.9;">emoji_events</span>
            <div>
              <div class="lvl" id="xpLevel">Level 1</div>
              <div class="title" id="xpTitle">Rookie</div>
            </div>
          </div>
          <div class="xpActivePill">ACTIVE</div>
        </div>
        <div class="xpMeta">
          <span id="xpText">0 / 300 XP</span>
          <span id="xpPct">0%</span>
        </div>
        <div class="xpBar"><div class="xpFill" id="xpFill"></div></div>
        <div class="mutedText" id="xpHint" style="margin-top:8px; font-weight:700;">Coach 3 more sprints to reach Level 2 Pro.</div>
      </div>
      <div style="margin-top:14px;">
        <div class="mutedText" style="margin-bottom:6px;">üé® Theme</div>
        <div class="inputWrap">
          <select class="fun-input" id="themeSelect" aria-label="Theme">
            <option value="light">üå§Ô∏è Light</option>
            <option value="mint">üçÉ Mint Arcade</option>
            <option value="neon">‚ö° Neon Arena</option>
            <option value="retro">üé≤ Retro Arcade</option>
          </select>
        </div>
      </div>
    
      <button class="helpBtn" type="button"><span class="material-symbols-rounded">support_agent</span>Help &amp; Support</button>
    </aside>

    <div class="navScrim" id="navScrim" aria-hidden="true"></div>

    <main class="main">
      <div class="coachWrap">

        <div class="tabBar">
          <button class="tabBtn active" data-tab="health" type="button">Health</button>
          <button class="tabBtn" data-tab="copilot" type="button">Copilot</button>
        </div>

        <section class="tabPanel" id="panel-health">
          <!-- Visual template: /testing/code.html (except Sprint History) -->
          <div class="coachHeader">
            <div>
              <button class="navBurger" id="navBurger" type="button" aria-label="Open menu">
                <span class="material-symbols-rounded">menu</span>
              </button>
              <h1 class="coachPageTitle">Coach Insights &amp; Analytics</h1>
              <p class="coachPageSub">Real-time performance metrics and guidance for Scrum Masters, Delivery Managers, and Enterprise leaders.</p>
            </div>
          </div>

          <div class="sectionCard heroCard">
            <h2 class="sectionTitle">Sprint Health Dashboard</h2>
            <p class="sectionSub">Trends + stability signals (no blame). Powered by your last 6 sprints.</p>

            <div class="info-banner">
              <strong>Tip:</strong> Pick a scenario from the dropdown (auto loads), or edit sprint history values and hit <b>Save</b>.
            </div>

            <!-- Sprint History -->
            <div class="historyWrap" id="hist_wrap" style="margin-top:12px;">
              <div class="historyHead">
                <div class="historyHeadLeft">
                  <button class="historyToggle" id="hist_toggleBtn" type="button" aria-expanded="true">
                    <span class="chev" aria-hidden="true">‚ñæ</span>
                    <span class="historyTitle">Sprint History (Last 6 sprints)</span>
                  </button>
                  <div class="historySub mutedText">
                    Used for: velocity, predictability, disruption, capacity fit, and team health.
                  </div>
                </div>

                <div class="historyActions">
<select class="fun-input" id="hist_demoVariant" aria-label="Demo data preset">
                    <option value="excellent">‚ú® Excellent</option>
                    <option value="normal" selected>‚úÖ Normal</option>
                    <option value="risky">‚ö†Ô∏è Risky</option>
                  </select>

                  <button class="btnPrimary" id="hist_saveBtn" type="button">Save</button>
                  <button class="btnGhost" id="hist_resetBtn" type="button">Reset</button>

                  <input class="fileInput" id="hist_csvInput" type="file" accept=".csv,text/csv" />
                  <button class="btnGhost" id="hist_uploadCsvBtn" type="button">Upload CSV</button>
                  <button class="btnGhost" id="hist_downloadTplBtn" type="button">Download Template</button>
                </div>
              </div>

              <div class="historyBody" id="hist_body">
                <div style="overflow:auto; margin-top:12px;">
                  <table class="historyTable">
                    <thead>
                      <tr>
                        <th>SPRINT</th>
                        <th>FORECAST SP</th>
                        <th>ACTUAL SP</th>
                        <th>COMMITTED SP</th>
                        <th>COMPLETED SP</th>
                        <th>SP ADDED</th>
                        <th>SP REMOVED</th>
                        <th>SICK LEAVES</th>
                      </tr>
                    </thead>
                    <tbody id="hist_rows"></tbody>
                  </table>
                </div>
                <div class="mutedText" id="hist_status" style="margin-top:10px;">‚Äî</div>
              </div>
            </div>

            <!-- Cleaner layout: metrics + charts first, insights below (less clumsy) -->
            <div class="coachBodyGrid">

              <div class="coachLeftCol">
                <!-- KPI tiles ‚Äî visual template (code.html) -->
                <div class="metricGrid" aria-label="Key sprint metrics">
                  <div class="metricCard">
                    <div class="metricTop">
                      <div class="metricName"><span class="material-symbols-rounded">trending_up</span> Sprint Velocity</div>
                      <div class="metricDelta" id="kpi_velVar">‚Äî</div>
                    </div>
                    <div class="metricValue"><span id="kpi_velAvg">‚Äî</span></div>
                    <div class="metricMeta">pts avg</div>
                    <div class="metricFormula" id="kpi_velFormula" style="display:none;">Avg(Completed SP)</div>
                  </div>

                  <div class="metricCard">
                    <div class="metricTop">
                      <div class="metricName"><span class="material-symbols-rounded">shield</span> Predictability</div>
                      <div class="metricDelta" id="kpi_predLatest">‚Äî</div>
                    </div>
                    <div class="metricValue"><span id="kpi_predAvg">‚Äî</span></div>
                    <div class="metricMeta">last 6 sprints</div>
                    <div class="metricFormula" id="kpi_predFormula" style="display:none;">Avg(Completed √∑ Committed) √ó 100</div>
                  </div>

                  <div class="metricCard">
                    <div class="metricTop">
                      <div class="metricName"><span class="material-symbols-rounded">swap_horiz</span> Scope Churn</div>
                      <div class="metricDelta" id="kpi_scopeHint">‚Äî</div>
                    </div>
                    <div class="metricValue"><span id="kpi_scopeAvg">‚Äî</span></div>
                    <div class="metricMeta">avg churn</div>
                    <div class="metricFormula" id="kpi_scopeFormula" style="display:none;">Avg(Added + Removed)</div>
                  </div>

                  <div class="metricCard">
                    <div class="metricTop">
                      <div class="metricName"><span class="material-symbols-rounded">target</span> Capacity Fit</div>
                      <div class="metricDelta" id="kpi_overcommitHint">‚Äî</div>
                    </div>
                    <div class="metricValue"><span id="kpi_overcommit">‚Äî</span></div>
                    <div class="metricMeta">latest ratio</div>
                    <div class="metricFormula" id="kpi_overcommitFormula" style="display:none;">Committed √∑ Forecast Capacity (latest)</div>
                  </div>
                </div>

                <div class="formulaCard" id="coach_formulaCard">
                  <button class="formulaToggle" id="formula_toggleBtn" type="button" aria-expanded="false">
                    <span class="material-symbols-rounded">functions</span>
                    <span>How these tiles are calculated</span>
                    <span class="chev" aria-hidden="true">‚ñæ</span>
                  </button>
                  <div class="formulaBody" id="formula_body" style="display:none;">
                    <ul class="formulaList">
                      <li><b>Avg Velocity</b> = Avg(Completed SP) across the last 6 sprints.</li>
                      <li><b>Predictability</b> = Avg(Completed √∑ Committed) √ó 100 (capped at 100%).</li>
                      <li><b>Scope Churn</b> = Avg(Added + Removed mid-sprint).</li>
                      <li><b>Capacity Fit</b> = Committed √∑ Forecast Capacity (latest sprint).</li>
                      <li><b>Team Health</b> is shown via the <b>Sick Leave Trend</b> chart (Œ£ sick leave person-days).</li>
                    </ul>
                  </div>
                </div>

                <!-- Charts -->

                <div class="chartsWrap">
                  <div class="chartGrid">

                    <div class="chartCard">
                      <div class="chartHeader">
                        <div>
                          <div class="chartTitleRow"><div class="chartTitle">Velocity Trend</div><span class="material-symbols-rounded chartInfo" title="Completed story points per sprint. Includes a 3-sprint rolling average line.">info</span></div>
                          <div class="chartSub">Completed SP (last 6 sprints)</div>
                        </div>
                        <div class="chartLegend">
                          <span class="legendPill" style="--dot:#2EB67D;"><span class="legendDot"></span>Completed</span>
                          <span class="legendPill" style="--dot:#36C5F0;"><span class="legendDot"></span>3-sprint avg</span>
                        </div>
                      </div>
                      <div class="chartCanvasWrap">
                        <canvas class="chartCanvas" id="hist_velocityChart"></canvas>
                      </div>
                    </div>

                    <div class="chartCard">
                      <div class="chartHeader">
                        <div>
                          <div class="chartTitleRow"><div class="chartTitle">Predictability</div><span class="material-symbols-rounded chartInfo" title="Completed √∑ Committed (%). Higher is better; 85‚Äì95% is a healthy zone.">info</span></div>
                          <div class="chartSub">Completed √∑ Committed (%)</div>
                        </div>
                        <div class="chartLegend">
                          <span class="legendPill" style="--dot:#36C5F0;"><span class="legendDot"></span>Predictability</span>
                        </div>
                      </div>
                      <div class="chartCanvasWrap">
                        <canvas class="chartCanvas" id="hist_predictChart"></canvas>
                      </div>
                    </div>

                    <div class="chartCard">
                      <div class="chartHeader">
                        <div>
                          <div class="chartTitleRow"><div class="chartTitle">Commitment vs Delivery</div><span class="material-symbols-rounded chartInfo" title="Bars compare Committed vs Completed each sprint. Large gaps usually mean spillover or scope churn.">info</span></div>
                          <div class="chartSub">Committed vs Completed</div>
                        </div>
                        <div class="chartLegend">
                          <span class="legendPill" style="--dot:#36C5F0;"><span class="legendDot"></span>Committed</span>
                          <span class="legendPill" style="--dot:#2EB67D;"><span class="legendDot"></span>Completed</span>
                        </div>
                      </div>
                      <div class="chartCanvasWrap">
                        <canvas class="chartCanvas" id="hist_commitChart"></canvas>
                      </div>
                    </div>

                    <div class="chartCard">
                      <div class="chartHeader">
                        <div>
                          <div class="chartTitleRow"><div class="chartTitle">Capacity Fit</div><span class="material-symbols-rounded chartInfo" title="Forecast capacity vs Completed. Helps detect chronic over/under-estimation of capacity.">info</span></div>
                          <div class="chartSub">Forecast vs Completed</div>
                        </div>
                        <div class="chartLegend">
                          <span class="legendPill" style="--dot:#ECB22E;"><span class="legendDot"></span>Forecast</span>
                          <span class="legendPill" style="--dot:#2EB67D;"><span class="legendDot"></span>Completed</span>
                        </div>
                      </div>
                      <div class="chartCanvasWrap">
                        <canvas class="chartCanvas" id="hist_capacityChart"></canvas>
                      </div>
                    </div>

                    <div class="chartCard">
                      <div class="chartHeader">
                        <div>
                          <div class="chartTitleRow"><div class="chartTitle">Scope Disruption</div><span class="material-symbols-rounded chartInfo" title="Mid-sprint Added vs Removed scope. High churn reduces predictability and focus.">info</span></div>
                          <div class="chartSub">Added vs Removed mid-sprint</div>
                        </div>
                        <div class="chartLegend">
                          <span class="legendPill" style="--dot:#2EB67D;"><span class="legendDot"></span>Added</span>
                          <span class="legendPill" style="--dot:#E01E5A;"><span class="legendDot"></span>Removed</span>
                        </div>
                      </div>
                      <div class="chartCanvasWrap">
                        <canvas class="chartCanvas" id="hist_disruptionChart"></canvas>
                      </div>
                    </div>

                    <div class="chartCard">
                      <div class="chartHeader">
                        <div>
                          <div class="chartTitleRow"><div class="chartTitle">Carryover Trend</div><span class="material-symbols-rounded chartInfo" title="Carryover = max(0, Committed ‚àí Completed). Spillover signal that can indicate overcommitment or blockers.">info</span></div>
                          <div class="chartSub">Spillover / under-commit signal</div>
                        </div>
                        <div class="chartLegend">
                          <span class="legendPill" style="--dot:#E01E5A;"><span class="legendDot"></span>Carryover</span>
                        </div>
                      </div>
                      <div class="chartCanvasWrap">
                        <canvas class="chartCanvas" id="hist_carryoverChart"></canvas>
                      </div>
                    </div>

                    <div class="chartCard">
                      <div class="chartHeader">
                        <div>
                          <div class="chartTitleRow"><div class="chartTitle">Overcommit Ratio</div><span class="material-symbols-rounded chartInfo" title="Overcommit Ratio = Committed √∑ Forecast Capacity. Target ‚âà 100%.">info</span></div>
                          <div class="chartSub">Committed √∑ Forecast Capacity (%)</div>
                        </div>
                        <div class="chartLegend">
                          <span class="legendPill" style="--dot:#ECB22E;"><span class="legendDot"></span>Overcommit</span>
                        </div>
                      </div>
                      <div class="chartCanvasWrap">
                        <canvas class="chartCanvas" id="hist_overcommitChart"></canvas>
                      </div>
                    </div>

                    <div class="chartCard">
                      <div class="chartHeader">
                        <div>
                          <div class="chartTitleRow"><div class="chartTitle">Scope Churn %</div><span class="material-symbols-rounded chartInfo" title="Scope Churn % = (Added + Removed) √∑ Committed. Under ~15% is a good target.">info</span></div>
                          <div class="chartSub">(Added + Removed) √∑ Committed (%)</div>
                        </div>
                        <div class="chartLegend">
                          <span class="legendPill" style="--dot:#36C5F0;"><span class="legendDot"></span>Churn %</span>
                        </div>
                      </div>
                      <div class="chartCanvasWrap">
                        <canvas class="chartCanvas" id="hist_churnPctChart"></canvas>
                      </div>
                    </div>

                    <div class="chartCard">
                      <div class="chartHeader">
                        <div>
                          <div class="chartTitleRow"><div class="chartTitle">Sick Leave Trend</div><span class="material-symbols-rounded chartInfo" title="Sick leave person-days each sprint. Spikes can indicate overload or interruptions.">info</span></div>
                          <div class="chartSub">Sick leave (person-days)</div>
                        </div>
                        <div class="chartLegend">
                          <span class="legendPill" style="--dot:#E01E5A;"><span class="legendDot"></span>Sick leave</span>
                        </div>
                      </div>
                      <div class="chartCanvasWrap">
                        <canvas class="chartCanvas" id="hist_sickChart"></canvas>
                      </div>
                    </div>

                  </div>
                </div>

                <!-- Coach Insights (moved below charts) -->
                <div class="insightsBox insightsBox--below">
                  <div class="insightsHead">
                    <div>
                      <div class="kvKey">Coach Insights</div>
                      <div class="mutedText">Explains the charts + suggests what to do next.</div>
                    </div>
                    <div class="insightsControls">
                      <span class="betaPill">AI Beta</span>
                      <select class="fun-input insightRoleSel" id="coach_roleSel" aria-label="Role view">
                        <option value="sm" selected>Scrum Master</option>
                        <option value="dm">Delivery Manager</option>
                        <option value="em">Enterprise Manager</option>
                      </select>
                    </div>
                  </div>
                  <div class="insightsStack" id="coach_insightsStack"></div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="tabPanel hidden" id="panel-copilot">
          <div class="sectionCard heroCard">
            <h1 class="sectionTitle">AI Ceremony Copilot</h1>
            <p class="sectionSub">Pick a ceremony ‚Üí get guided prompts ‚Üí capture outcomes.</p>

            <div class="info-banner">
              <strong>Pro move:</strong> Use Copilot in <b>Daily Scrum</b> to keep your streak alive.
            </div>

            <div class="copilotGrid">
              <div class="copilotLeft">

                <div class="copilotPills" id="copilot_pills" role="tablist" aria-label="Ceremony picker">
                  <button type="button" class="pillBtn active" data-ceremony="planning">üóìÔ∏è Planning</button>
                  <button type="button" class="pillBtn" data-ceremony="daily">‚òÄÔ∏è Daily</button>
                  <button type="button" class="pillBtn" data-ceremony="refinement">‚≠ê Refinement</button>
                  <button type="button" class="pillBtn" data-ceremony="review">üéØ Review</button>
                  <button type="button" class="pillBtn" data-ceremony="retro">‚ôªÔ∏è Retro</button>
                </div>

                <div class="sectionCard" style="padding:14px;">
                  <div class="copilotCardHead">
                    <div>
                      <div class="kvKey">Choose a ceremony</div>
                      <div class="mutedText">Your prompts update based on your last 6 sprints.</div>
                    </div>
                    <button class="btnGhost" id="copilot_newAngleBtn" type="button">
                      <span class="material-symbols-rounded">shuffle</span> New angle
                    </button>
                  </div>

                  <div class="promptList" id="copilot_prompts"></div>
                  <div class="mutedText" id="copilot_promptsEmpty" style="margin-top:10px;">Your prompts will appear here.</div>
                </div>

                <div class="sectionCard" style="padding:14px;">
                  <div class="copilotCardHead">
                    <div>
                      <div class="kvKey">Capture decisions</div>
                      <div class="mutedText">Saved locally in your browser. (Later we can sync this to cloud too.)</div>
                    </div>
                  </div>

                  <textarea class="fun-textarea" id="copilot_notes" rows="5" placeholder="Decisions, actions, owners, due dates‚Ä¶"></textarea>

                  <div class="copilotBtnRow">
                    <button class="btnPrimary" id="copilot_saveBtn" type="button">Save</button>
                    <button class="btnGhost" id="copilot_resetBtn" type="button">Reset</button>
                    <span class="mutedText" id="copilot_status">‚Äî</span>
                  </div>
                </div>

              </div>

              <aside class="copilotRight">
                <div class="sectionCard" style="padding:14px;">
                  <div class="copilotCardHead">
                    <div>
                      <div class="kvKey">Saved Decisions</div>
                      <div class="mutedText">One-click summary for sharing.</div>
                    </div>
                    <button class="btnGhost" id="copilot_copyBtn" type="button">
                      <span class="material-symbols-rounded">content_copy</span> Copy Summary
                    </button>
                  </div>

                  <div class="savedList" id="copilot_saved"></div>
                </div>
              
      <button class="helpBtn" type="button"><span class="material-symbols-rounded">support_agent</span>Help &amp; Support</button>
    </aside>
            </div>

          </div>
        </section>

      </div>
    </main>
  </div>

  <script>
    // Tabs
    (function(){
      const btns = Array.from(document.querySelectorAll(".tabBtn"));
      const panels = { health: document.getElementById("panel-health"), copilot: document.getElementById("panel-copilot") };
      function show(name){
        btns.forEach(b => b.classList.toggle("active", b.dataset.tab === name));
        Object.keys(panels).forEach(k => panels[k]?.classList.toggle("hidden", k !== name));
      }
      btns.forEach(b => b.addEventListener("click", () => show(b.dataset.tab)));
      show("health");
    })();

    // Metric formula accordion
    (function(){
      const wrap = document.getElementById('coach_formulaCard');
      const btn = document.getElementById('formula_toggleBtn');
      const body = document.getElementById('formula_body');
      if(!wrap || !btn || !body) return;
      btn.addEventListener('click', ()=>{
        const open = body.style.display !== 'none';
        body.style.display = open ? 'none' : '';
        btn.setAttribute('aria-expanded', String(!open));
        wrap.classList.toggle('is-open', !open);
      });
    })();

    // Mobile nav drawer
    (function(){
      const burger = document.getElementById('navBurger');
      const scrim = document.getElementById('navScrim');
      const body = document.body;
      if(!burger || !scrim) return;
      const close = ()=> body.classList.remove('nav-open');
      burger.addEventListener('click', ()=> body.classList.toggle('nav-open'));
      scrim.addEventListener('click', close);
      window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') close(); });
    })();
  </script>

  <script src="../js/theme.js?v=221"></script>
  <script src="../js/xp.js?v=221"></script>

  <script src="../js/coach-history.js?v=221"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script src="../js/coach-addons.js?v=221"></script>
  <script src="../js/coach-copilot.js?v=217"></script>
</body>
</html>

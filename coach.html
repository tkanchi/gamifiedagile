<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width,initial-scale=1" name="viewport"/>
  <title>Scrummer ‚Äî Coach</title>

  <!-- ‚úÖ MUST load both -->
  <link rel="stylesheet" href="css/style.css?v=50">
  <link rel="stylesheet" href="css/coach.css?v=50">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>

  <style>
    /* Keep only tiny page-local helpers; styling belongs in css/coach.css */
    .tabBar{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 14px}
    .tabPanel.hidden{display:none}
    .coachWrap{max-width:1100px;margin:0 auto;width:100%;}
    .fileInput{ display:none; }
  </style>
</head>

<body data-page="coach">
  <div class="appShell">

    <aside class="sideNav">
      <div class="sideBrand">
        <div class="brandMark"><span>S</span></div>
        <div>
          <div class="brandName">SCRUMMER</div>
          <div class="brandTag">Gamified Scrum OS</div>
        </div>
      </div>

      <nav class="nav">
        <a class="navlink" href="index.html">üöÄ Plan</a>
        <a class="navlink active" href="coach.html">ü§ñ Coach</a>
        <a class="navlink" href="Gamerules.html">üéÆ Game Rules</a>
        <a class="navlink" href="accounts.html">üîê Account</a>
      </nav>

      <div class="xpWidget">
        <div class="xpTop">
          <div>
            <div class="lvl" id="xpLevel">Level 1</div>
            <div class="title" id="xpTitle">Rookie</div>
          </div>
          <div id="moodBadge">üêÜ Calm</div>
        </div>
        <div class="xpBar">
          <div class="xpFill" id="xpFill"></div>
        </div>
        <div class="xpMeta">
          <span id="xpText">0 / 300 XP</span>
          <span id="streakText">üßä streak reset</span>
        </div>
      </div>

      <button class="themeToggle" id="themeToggle" type="button">
        Theme: <span id="themeMode">Light</span>
      </button>
    </aside>

    <main class="main">
      <div class="coachWrap">

        <div class="tabBar">
          <button class="tabBtn active" data-tab="health" type="button">Health</button>
          <button class="tabBtn" data-tab="copilot" type="button">Copilot</button>
        </div>

        <!-- ================= HEALTH ================= -->
        <section class="tabPanel" id="panel-health">
          <div class="sectionCard heroCard">
            <h1 class="sectionTitle">Sprint Health Dashboard</h1>
            <p class="sectionSub">Trends + stability signals (no blame). Powered by your last 6 sprints.</p>

            <div class="info-banner">
              <strong>Tip:</strong> Load demo data once ‚Äî charts update instantly (no extra clicks).
            </div>

            <!-- ‚úÖ Sprint History (Collapsible) -->
            <div class="historyWrap" id="hist_wrap" style="margin-top:12px;">
              <div class="historyHead">
                <div class="historyHeadLeft">
                  <button class="historyToggle" id="hist_toggleBtn" type="button" aria-expanded="true">
                    <span class="chev" aria-hidden="true">‚ñæ</span>
                    <span class="historyTitle">Sprint History (Last 6 sprints)</span>
                  </button>
                  <div class="historySub mutedText">
                    Use this for trends: velocity, predictability, disruption, team health, and capacity accuracy.
                  </div>
                </div>

                <div class="historyActions">
                  <button class="btnGhost" id="hist_autofillBtn" type="button">‚ú® Auto-fill from Plan</button>

                  <select class="fun-input" id="hist_demoVariant" style="min-width:260px;">
                    <option value="stable">üü¢ Stable mature team</option>
                    <option value="recovery" selected>üü° Chaos ‚Üí recovery arc</option>
                    <option value="overcommit">üî¥ Overcommit streak ‚Üí correction</option>
                  </select>

                  <button class="btnGhost" id="hist_demoBtn" type="button">Load Demo Data</button>
                  <button class="btnPrimary" id="hist_saveBtn" type="button">Save</button>
                  <button class="btnGhost" id="hist_resetBtn" type="button">Reset</button>

                  <input class="fileInput" id="hist_csvInput" type="file" accept=".csv,text/csv" />
                  <button class="btnGhost" id="hist_uploadCsvBtn" type="button">Upload CSV</button>
                  <button class="btnGhost" id="hist_downloadTplBtn" type="button">Download Template</button>
                </div>
              </div>

              <div class="historyBody" id="hist_body">
                <div style="overflow:auto; margin-top:12px;">
                  <table class="historyTable">
                    <thead>
                      <tr>
                        <th align="center">SPRINT</th>
                        <th align="center">FORECAST SP</th>
                        <th align="center">ACTUAL SP</th>
                        <th align="center">COMMITTED SP</th>
                        <th align="center">COMPLETED SP</th>
                        <th align="center">SP ADDED</th>
                        <th align="center">SP REMOVED</th>
                        <th align="center">SICK LEAVES</th>
                      </tr>
                    </thead>
                    <tbody id="hist_rows"></tbody>
                  </table>
                </div>

                <div class="mutedText" id="hist_status" style="margin-top:10px;">‚Äî</div>
              </div>
            </div>

            <!-- Charts -->
            <div class="info-banner" style="margin-top:14px;">
              <div class="kvKey">Coach Charts</div>
              <div class="mutedText" style="margin-top:6px;">
                Charts auto-render after <b>Load Demo Data</b> / <b>Save</b> / CSV import.
              </div>

              <div class="chartGrid">

                <!-- Velocity -->
                <div class="chartCard">
                  <div class="chartHeader">
                    <div>
                      <div class="chartTitle">Velocity Trend</div>
                      <div class="chartSub">Completed SP (last 6 sprints)</div>
                    </div>
                    <div class="chartLegend">
                      <span class="legendPill" style="--dot:#6366f1;"><span class="legendDot"></span>Completed SP</span>
                    </div>
                  </div>
                  <div class="chartCanvasWrap">
                    <canvas class="chartCanvas" id="hist_velocityChart"></canvas>
                  </div>
                </div>

                <!-- Predictability -->
                <div class="chartCard">
                  <div class="chartHeader">
                    <div>
                      <div class="chartTitle">Predictability</div>
                      <div class="chartSub">Completed √∑ Committed (%)</div>
                    </div>
                    <div class="chartLegend">
                      <span class="legendPill" style="--dot:#6366f1;"><span class="legendDot"></span>Predictability (%)</span>
                    </div>
                  </div>
                  <div class="chartCanvasWrap">
                    <canvas class="chartCanvas" id="hist_predictChart"></canvas>
                  </div>
                </div>

                <!-- Capacity -->
                <div class="chartCard">
                  <div class="chartHeader">
                    <div>
                      <div class="chartTitle">Capacity Fit</div>
                      <div class="chartSub">Capacity vs Completed</div>
                    </div>
                    <div class="chartLegend">
                      <span class="legendPill" style="--dot:#f59e0b;"><span class="legendDot"></span>Capacity</span>
                      <span class="legendPill" style="--dot:#22c55e;"><span class="legendDot"></span>Completed</span>
                    </div>
                  </div>
                  <div class="chartCanvasWrap">
                    <canvas class="chartCanvas" id="hist_capacityChart"></canvas>
                  </div>
                </div>

                <!-- Scope -->
                <div class="chartCard">
                  <div class="chartHeader">
                    <div>
                      <div class="chartTitle">Scope Disruption</div>
                      <div class="chartSub">Added vs Removed mid-sprint</div>
                    </div>
                    <div class="chartLegend">
                      <span class="legendPill" style="--dot:#22c55e;"><span class="legendDot"></span>Added</span>
                      <span class="legendPill" style="--dot:#ef4444;"><span class="legendDot"></span>Removed</span>
                    </div>
                  </div>
                  <div class="chartCanvasWrap">
                    <canvas class="chartCanvas" id="hist_disruptionChart"></canvas>
                  </div>
                </div>

                <!-- Sick leave -->
                <div class="chartCard span2">
                  <div class="chartHeader">
                    <div>
                      <div class="chartTitle">Team Health</div>
                      <div class="chartSub">Sick leave (person-days)</div>
                    </div>
                    <div class="chartLegend">
                      <span class="legendPill" style="--dot:#ef4444;"><span class="legendDot"></span>Sick leave</span>
                    </div>
                  </div>
                  <div class="chartCanvasWrap">
                    <canvas class="chartCanvas" id="hist_sickChart"></canvas>
                  </div>
                </div>

              </div>
            </div>

            <!-- Insights -->
            <div class="info-banner" style="margin-top:14px;">
              <div class="kvKey" style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
                <span>Coach Insights</span>
                <span class="mutedText" style="margin:0;">Auto-generated from the last 6 sprints</span>
              </div>

              <div class="insightsStack" id="coach_insightsStack">
                <!-- your JS can populate this; these are safe placeholders -->
              </div>
            </div>

          </div>
        </section>

        <!-- ================= COPILOT ================= -->
        <section class="tabPanel hidden" id="panel-copilot">
          <div class="sectionCard">
            <h1 class="sectionTitle">AI Ceremony Copilot</h1>
            <p class="sectionSub">Pick a ceremony ‚Üí guided prompts ‚Üí capture outcomes.</p>

            <div class="info-banner">
              <strong>Pro move:</strong> Use Copilot in Daily Scrum to keep your streak alive. üèÜ
            </div>

            <div class="ceremonyRow" id="copilot_ceremonyRow">
              <button class="btnGhost cerBtn" data-cer="planning" type="button">üó∫Ô∏è Planning</button>
              <button class="btnGhost cerBtn" data-cer="daily" type="button">üß© Daily</button>
              <button class="btnGhost cerBtn" data-cer="refine" type="button">üß† Refinement</button>
              <button class="btnGhost cerBtn" data-cer="review" type="button">üé¨ Review</button>
              <button class="btnGhost cerBtn" data-cer="retro" type="button">‚ôªÔ∏è Retro</button>
            </div>

            <div class="info-banner" style="margin-top:14px;">
              <div class="kvKey">Capture decisions</div>
              <textarea class="fun-input" id="copilot_decisionNotes" placeholder="Decisions / risks / owners..." rows="5"></textarea>
              <div class="btnRow" style="margin-top:10px;">
                <button class="btnPrimary" id="copilot_saveBtn" type="button">Save</button>
                <button class="btnGhost" id="copilot_clearBtn" type="button">Reset</button>
              </div>
              <div id="copilot_saveStatus" style="margin-top:10px; font-weight:650;"></div>
            </div>
          </div>
        </section>

      </div>
    </main>
  </div>

  <!-- ‚úÖ Tab switcher (so the page works even if other scripts don‚Äôt manage tabs) -->
  <script>
    (function(){
      const btns = Array.from(document.querySelectorAll(".tabBtn"));
      const panels = {
        health: document.getElementById("panel-health"),
        copilot: document.getElementById("panel-copilot")
      };
      function show(name){
        btns.forEach(b => b.classList.toggle("active", b.dataset.tab === name));
        Object.keys(panels).forEach(k => panels[k]?.classList.toggle("hidden", k !== name));
      }
      btns.forEach(b => b.addEventListener("click", () => show(b.dataset.tab)));
      show("health");
    })();
  </script>

  <!-- Your existing scripts -->
  <script src="js/theme.js?v=50"></script>
  <script src="js/xp.js?v=50"></script>

  <script src="js/coach-history.js?v=50"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script src="js/coach-addons.js?v=50"></script>


  <script>
(function () {
  const KEY = "scrummer_demo_variant_v1";
  const sel = document.getElementById("hist_demoVariant");
  const btn = document.getElementById("hist_demoBtn");
  if (!sel || !btn) return;

  // restore last selection
  try {
    const saved = localStorage.getItem(KEY);
    if (saved) sel.value = saved;
  } catch {}

  function applyVariant(v){
    try { localStorage.setItem(KEY, v); } catch {}
    // some implementations read data-variant from the button
    btn.dataset.variant = v;
    // if coach-history exposes APIs, use them; else click
    const api = window.ScrummerCoachHistory;
    if (api?.loadDemoVariant) return api.loadDemoVariant(v);
    if (api?.loadDemoData) return api.loadDemoData(v);
    btn.click();
  }

  // change = load immediately
  sel.addEventListener("change", () => applyVariant(sel.value));

  // ensure clicking Load Demo uses latest selection
  btn.addEventListener("click", () => applyVariant(sel.value), true);
})();
</script>
</body>
</html>

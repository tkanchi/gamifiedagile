<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<title>Scrummer â€” Coach</title>
<link href="css/style.css?v=3" rel="stylesheet"/>
<!-- Unified Font (keep this on every page) -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
<style>
.tabBar{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 14px}
.tabBtn{border-radius:14px;padding:10px 14px;font-weight:650;cursor:pointer;border:1px solid var(--border);background:var(--bg-soft);color:var(--text-main);transition:transform .12s ease, filter .12s ease, background .12s ease, border-color .12s ease;}
.tabBtn:hover{transform:translateY(-1px)}
.tabBtn.active{background: rgba(99,102,241,0.95); color:#fff; border-color: rgba(99,102,241,0.55); box-shadow: 0 10px 24px rgba(99,102,241,0.18);}
.tabPanel.hidden{display:none}

/* ===== Sprint History table (Coach) â€” added ===== */
.historyWrap{ margin-top: 12px; }
.historyTop{
  display:flex; justify-content:space-between; align-items:flex-end; gap:10px; flex-wrap:wrap;
}
.historyActions{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
.historyTable{
  width:100%;
  border-collapse:separate;
  border-spacing:0;
  overflow:hidden;
  border-radius: 14px;
  border: 1px solid var(--border);
  background: var(--bg-soft);
}
.historyTable th, .historyTable td{
  padding: 10px 10px;
  border-bottom: 1px solid var(--border-soft);
  vertical-align: middle;
  white-space: nowrap;
}
.historyTable thead th{
  font-size: 12px;
  letter-spacing: .2px;
  color: var(--text-muted);
  font-weight: 750;
  background: color-mix(in oklab, var(--bg-soft) 72%, rgba(99,102,241,0.06));
}
.historyTable tbody tr:last-child td{ border-bottom:none; }
.historyTable td:first-child, .historyTable th:first-child{ padding-left: 12px; }
.historyTable td:last-child, .historyTable th:last-child{ padding-right: 12px; }

.histNum{
  width: 92px;
  min-width: 92px;
}
.histSprint{
  font-weight: 800;
}
.histAutoPill{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding: 4px 8px;
  border-radius: 999px;
  border: 1px solid var(--border);
  background: var(--bg-panel);
  color: var(--text-muted);
  font-size: 11px;
  font-weight: 750;
  margin-left: 8px;
}
.fileInput{ display:none; }

/* ===== Chart placeholders (no library yet) ===== */
.chartCanvas{
  width: 100%;
  display:block;
  border-radius: 14px;
  border: 1px solid var(--border-soft);
  background: color-mix(in oklab, var(--bg-panel) 92%, rgba(99,102,241,0.04));
}
.chartHint{
  margin-top: 10px;
  color: var(--text-muted);
  font-weight: 450;
  line-height: 1.6;
}
</style>
</head>

<body data-page="coach">
<div class="appShell">
<aside class="sideNav">
<div class="sideBrand">
<div class="brandMark"><span>S</span></div>
<div>
<div class="brandName">SCRUMMER</div>
<div class="brandTag">Gamified Scrum OS</div>
</div>
</div>
<!-- Nav Bar -->
<nav class="nav"><a class="navlink" href="index.html">ğŸš€ Plan</a><a class="navlink active" href="coach.html">ğŸ¤– Coach</a><a class="navlink" href="Gamerules.html">ğŸ® Game Rules</a><a class="navlink" href="accounts.html">ğŸ” Account</a></nav>
<div class="xpWidget">
<div class="xpTop">
<div>
<div class="lvl" id="xpLevel">Level 1</div>
<div class="title" id="xpTitle">Rookie</div>
</div>
<div id="moodBadge">ğŸ† Calm</div>
</div>
<div class="xpBar">
<div class="xpFill" id="xpFill"></div>
</div>
<div class="xpMeta">
<span id="xpText">0 / 300 XP</span>
<span id="streakText">ğŸ§Š streak reset</span>
</div>
</div>
<button class="themeToggle" id="themeToggle" type="button">
        Theme: <span id="themeMode">Light</span>
</button>
</aside>

<main class="main">
<div class="tabBar">
<button class="tabBtn active" data-tab="insights">Insights</button>
<button class="tabBtn" data-tab="health">Health</button>
<button class="tabBtn" data-tab="actions">Actions</button>
<button class="tabBtn" data-tab="copilot">Copilot</button>
</div>

<section class="tabPanel" id="panel-insights">
<div class="sectionCard">
<h1 class="sectionTitle">Sprint Intelligence</h1>
<p class="sectionSub">Risk, confidence, and capacity signals for this sprint.</p>
<div class="info-banner">
<strong>Executive View:</strong> Clear signals, no blame. Save a snapshot to power ğŸ›¡ï¸ Health.
        </div>
<div class="info-banner" id="insights_toast" style="display:none; margin-top:12px; border-left:4px solid rgba(99,102,241,.55);">
          â€”
        </div>
<div style="display:grid; gap:12px; margin-top:12px;">
<div class="info-banner">
<div class="kvKey">Risk Score</div>
<div id="insights_riskScore" style="font-size:24px; font-weight:650; margin-top:4px;">â€”</div>
<div class="mutedText" id="insights_riskBand" style="margin-top:2px;">â€”</div>
</div>
<div class="info-banner">
<div class="kvKey">Confidence</div>
<div style="font-size:24px; font-weight:650; margin-top:4px;">
<span id="insights_confidence">â€”</span>%
            </div>
<div class="mutedText" id="insights_confidenceLabel" style="margin-top:2px;">â€”</div>
</div>
<div class="info-banner">
<div class="kvKey">Capacity Health</div>
<div id="insights_health" style="font-size:18px; font-weight:650; margin-top:4px;">â€”</div>
<div class="mutedText" id="insights_capacityNote" style="margin-top:2px;">â€”</div>
</div>
</div>
<div class="info-banner" style="margin-top:14px;">
<div class="kvKey">Inputs detected</div>
<div class="mutedText" id="insights_inputsDetected" style="margin-top:6px;">â€”</div>
</div>
<div class="stageIndicator">Flow: Setup â†’ Insights â†’ ğŸ›¡ï¸ Health â†’ Actions</div>
<div class="stageFooter">
<div class="left">
<a class="btnStage btnStage-back" href="index.html">â† Back: Setup</a>
</div>
<div class="right">
<button class="btnStage btnStage-action" id="insights_refreshAndSaveBtn" type="button">Refresh + Save Snapshot</button>
<a class="btnStage btnStage-next" href="coach.html#health">Next: ğŸ›¡ï¸ Health â†’</a>
</div>
</div>
</div>
</section>

<section class="tabPanel hidden" id="panel-health">
<div class="sectionCard">
<h1 class="sectionTitle">Sprint Health Dashboard</h1>
<p class="sectionSub">Executive view: trends, stability, and explanation â€” without blame.</p>
<div class="info-banner">
<strong>Tip:</strong> Health improves when risk trends down and commitment matches capacity.
        </div>

<!-- âœ… Sprint History (Last 6 sprints) -->
<div class="info-banner historyWrap" style="margin-top:12px;">
  <div class="historyTop">
    <div>
      <div class="kvKey">Sprint History (Last 6 sprints)</div>
      <div class="mutedText" style="margin-top:6px;">
        Fill this table to unlock charts: velocity trend, predictability, rolling averages, disruption, team health, and capacity accuracy.
      </div>
    </div>

    <div class="historyActions">
      <button class="btnGhost" id="hist_autofillBtn" type="button">âœ¨ Auto-fill from Plan</button>
      <button class="btnGhost" id="hist_demoBtn" type="button">ğŸ§ª Load Demo Data</button>
      <button class="btnPrimary" id="hist_saveBtn" type="button">Save</button>
      <button class="btnGhost" id="hist_resetBtn" type="button">Reset</button>

      <input class="fileInput" id="hist_csvInput" type="file" accept=".csv,text/csv" />
      <button class="btnGhost" id="hist_uploadCsvBtn" type="button">Upload CSV</button>
      <button class="btnGhost" id="hist_downloadTplBtn" type="button">Download Template</button>
    </div>
  </div>

  <div style="overflow:auto; margin-top:12px;">
    <table class="historyTable">
      <thead>
        <tr>
          <th align="left">Sprint</th>
          <th align="right">Forecast Capacity (SP)</th>
          <th align="right">Actual Capacity (SP)</th>
          <th align="right">Committed SP</th>
          <th align="right">Completed SP</th>
          <th align="right">SP Added (mid)</th>
          <th align="right">SP Removed (mid)</th>
          <th align="right">Sick leave (person-days)</th>
        </tr>
      </thead>
      <tbody id="hist_rows">
        <!-- Rows are generated by js/coach-history.js -->
      </tbody>
    </table>
  </div>

  <div class="mutedText" id="hist_status" style="margin-top:10px;">â€”</div>
</div>
<!-- /Sprint History -->

<!-- âœ… Chart placeholders (no external libs; JS can render later safely) -->
<div class="info-banner" style="margin-top:12px;">
  <div class="kvKey">ğŸ“ˆ Velocity Trend (Completed SP) + Rolling Avg</div>
  <canvas id="velocityChart" class="chartCanvas" height="120"></canvas>
  <div class="chartHint">Chart will render from your Sprint History data (Completed SP). Rolling average uses last 3 sprints.</div>
</div>

<div class="info-banner" style="margin-top:12px;">
  <div class="kvKey">ğŸ¯ Predictability Trend (%)</div>
  <canvas id="predictabilityChart" class="chartCanvas" height="120"></canvas>
  <div class="chartHint">Predictability = Completed Ã· Committed Ã— 100. Trend becomes meaningful after a few sprints.</div>
</div>
<!-- /Chart placeholders -->

<div class="info-banner" id="health_toast" style="display:none; margin-top:12px; border-left:4px solid rgba(99,102,241,.55);">
          â€”
        </div>
<div class="healthGrid" style="margin-top:12px;">
<div class="info-banner">
<div class="kvKey">Stability Index</div>
<div class="bigMetric" id="health_stabilityIndex">â€”</div>
<div class="mutedText" id="health_stabilityLabel">â€”</div>
</div>
<div class="info-banner">
<div class="kvKey">Latest Mode</div>
<div class="bigMetric" id="health_latestMode">â€”</div>
<div class="mutedText" id="health_latestModeHint">â€”</div>
</div>
<div class="info-banner">
<div class="kvKey">Overcommit Streak</div>
<div class="bigMetric" id="health_overcommitStreak">â€”</div>
<div class="mutedText" id="health_overcommitHint">â€”</div>
</div>
<div class="info-banner">
<div class="kvKey">Predictability</div>
<div class="bigMetric" id="health_predictability">â€”</div>
<div class="mutedText" id="health_predictabilityHint">â€”</div>
</div>
</div>
<div class="info-banner" style="margin-top:12px;">
<div class="kvKey">Executive Narrative</div>
<div id="health_narrative" style="margin-top:8px; line-height:1.8; font-weight:450; color:var(--text-main);">â€”</div>
</div>
<div class="info-banner" style="margin-top:12px;">
<div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
<div class="kvKey">Last 5 sprint snapshots</div>
<div class="btnRow" style="margin:0;">
<button class="btnGhost" id="health_newSprintBtn" type="button">â• New Sprint</button>
<button class="btnGhost" id="health_clearHistoryBtn" type="button">ğŸ§¹ Clear History</button>
<button class="btnPrimary" id="health_refreshHealthBtn" type="button">Refresh</button>
</div>
</div>
<div style="overflow:auto; margin-top:10px;">
<table class="healthTable" style="width:100%; border-collapse:collapse;">
<thead>
<tr>
<th align="left">When</th>
<th align="left">Mode</th>
<th align="right">Risk</th>
<th align="right">Conf</th>
<th align="right">Committed</th>
<th align="right">Capacity</th>
<th align="right">Over</th>
</tr>
</thead>
<tbody id="health_historyRows">
<tr>
<td colspan="7" style="padding:10px; color:var(--text-muted);">
                    No snapshots yet. Go to Insights â†’ â€œRefresh + Save Snapshotâ€.
                  </td>
</tr>
</tbody>
</table>
</div>
<div class="mutedText" style="margin-top:10px;">
            *History is saved locally in your browser.
          </div>
</div>
<div class="stageIndicator">Flow: Setup â†’ Insights â†’ ğŸ›¡ï¸ Health â†’ Actions</div>
<div class="stageFooter">
<div class="left">
<a class="btnStage btnStage-back" href="coach.html#insights">â† Back: Insights</a>
</div>
<div class="right">
<button class="btnStage btnStage-action" id="health_refreshHealthBtn2" type="button">Refresh Health</button>
<a class="btnStage btnStage-next" href="coach.html#actions">Next: Actions â†’</a>
</div>
</div>
</div>
</section>

<section class="tabPanel hidden" id="panel-actions">
<div class="sectionCard">
<h1 class="sectionTitle">Recommended Actions</h1>
<p class="sectionSub">Battle plan to reduce risk and boost confidence.</p>
<div class="info-banner">
<strong>Note:</strong> Actions are generated from Setup inputs + your latest snapshot.
        </div>
<div id="actions_actionsWrap" style="display:grid; gap:12px; margin-top:10px;"></div>
<div class="stageIndicator">Flow: Setup â†’ Insights â†’ ğŸ›¡ï¸ Health â†’ Actions</div>
<div class="stageFooter">
<div class="left">
<a class="btnStage btnStage-back" href="coach.html#health">â† Back: ğŸ›¡ï¸ Health</a>
</div>
<div class="right">
<button class="btnStage btnStage-action" id="actions_refreshBtn" type="button">Refresh Actions</button>
<a class="btnStage btnStage-next" href="coach.html#copilot">Next: Copilot â†’</a>
</div>
</div>
</div>
</section>

<section class="tabPanel hidden" id="panel-copilot">
<div class="sectionCard">
<h1 class="sectionTitle">AI Ceremony Copilot</h1>
<p class="sectionSub">Pick a ceremony â†’ get guided prompts â†’ capture outcomes.</p>
<div class="info-banner">
<strong>Pro move:</strong> Use Copilot in Daily Scrum to keep your streak alive. ğŸ†
        </div>
<!-- Dynamic mode banner -->
<div class="info-banner" id="copilot_modeBanner" style="margin-top:12px; display:none;">
<div class="kvKey" id="copilot_modeTitle">â€”</div>
<div class="modeBody" id="copilot_modeBody" style="color:var(--text-muted); font-weight:450; margin-top:6px; line-height:1.7;">â€”</div>
</div>
<!-- Ceremony buttons -->
<div class="ceremonyRow" id="copilot_ceremonyRow">
<button class="btnGhost cerBtn" data-cer="planning" type="button">ğŸ—ºï¸ Planning</button>
<button class="btnGhost cerBtn" data-cer="daily" type="button">ğŸ§© Daily</button>
<button class="btnGhost cerBtn" data-cer="refine" type="button">ğŸ§  Refinement</button>
<button class="btnGhost cerBtn" data-cer="review" type="button">ğŸ¬ Review</button>
<button class="btnGhost cerBtn" data-cer="retro" type="button">â™»ï¸ Retro</button>
</div>
<!-- Prompt panel -->
<div class="info-banner" style="margin-top:14px;">
<div class="kvKey" style="font-size:16px; display:flex; align-items:center; justify-content:space-between; gap:10px;">
<span id="copilot_panelTitle">Choose a ceremony</span>
<!-- New angle -->
<button class="btnGhost" id="copilot_newAngleBtn" style="padding:8px 10px;" type="button">
              ğŸ”„ New angle
            </button>
</div>
<div class="panelBody" id="copilot_panelBody" style="color:var(--text-muted); font-weight:450; margin-top:6px; line-height:1.7;">
            Your prompts will appear here.
          </div>
</div>
<!-- Notes -->
<div class="info-banner" style="margin-top:14px;">
<div class="kvKey">Capture decisions</div>
<div class="mutedText" style="margin-top:6px; color:var(--text-muted); font-weight:450;">
            Saved locally in your browser. (Later we can sync this to cloud too.)
          </div>
<textarea class="fun-input" id="copilot_decisionNotes" placeholder="Decisions / risks / owners..." rows="5"></textarea>
<div class="btnRow" style="margin-top:10px;">
<button class="btnPrimary" id="copilot_saveBtn" type="button">Save</button>
<button class="btnGhost" id="copilot_clearBtn" type="button">Reset</button>
</div>
<div id="copilot_saveStatus" style="margin-top:10px; font-weight:650;"></div>
<div class="mutedText" id="copilot_saveHint" style="margin-top:6px; color:var(--text-muted); font-weight:450;"></div>
<!-- âœ… Saved Decisions History (visible on screen) -->
<div class="info-banner" style="margin-top:12px;">
<div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
<div class="kvKey">Saved Decisions</div>
<!-- âœ… Copy Retro Summary -->
<button class="btnGhost" id="copilot_copyRetroBtn" style="padding:8px 10px;" type="button">
                ğŸ“‹ Copy Retro Summary
              </button>
</div>
<div id="copilot_decisionsEmpty" style="color:var(--text-muted); font-weight:450; margin-top:6px;">
              No saved decisions yet.
            </div>
<div id="copilot_decisionsList" style="display:grid; gap:10px; margin-top:10px;"></div>
</div>
</div>
<div class="btnRow" style="margin-top:12px;">
<a class="btnGhost" href="coach.html#actions">â† Back to Actions</a>
<a class="btnGhost" href="index.html">Back to Setup</a>
</div>
</div>
</section>
</main>
</div>

<!-- NOTE: Supabase removed from this page to avoid duplicate loads. -->
<script src="js/theme.js"></script>
<script src="js/xp.js"></script>
<script src="js/coach.js"></script>
<script src="js/coach-history.js"></script>
</body>
</html>